<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
    CommentMapper.xml
    - 댓글 및 대댓글 CRUD
    - BoardComment DTO와 호환
-->
<mapper namespace="edu.kh.eightgyosi.board.model.mapper.CommentMapper">

    <!-- 댓글/대댓글 목록 조회 -->
    <select id="selectCommentList" parameterType="int" resultType="BoardComment">
        SELECT
            C.COMMENT_ID,
            C.BOARD_ID,
            C.MEMBER_NO,
            M.MEMBER_NICKNAME,
            C.COMMENT_CONTENT,
            C.CREATE_DATE,
            C.PARENT_COMMENT_NO,
            C.COMMENT_DEL_FL
        FROM BOARD_COMMENT C
        JOIN MEMBER M ON C.MEMBER_NO = M.MEMBER_NO
        WHERE C.BOARD_ID = #{boardId}
        ORDER BY C.PARENT_COMMENT_NO NULLS FIRST, C.CREATE_DATE
    </select>

    <!-- 댓글/대댓글 등록 -->
    <insert id="insertComment" parameterType="BoardComment">
        INSERT INTO "COMMENT"
        VALUES(SEQ_COMMENT_NO.NEXTVAL, #{commentContent}, DEFAULT, DEFAULT, #{boardId}, #{memberNo}, 
        <!-- 자식 댓글(답글) -->
		<if test="parentCommentNo != 0">
			#{parentCommentNo}
		</if>
		
		<!-- 부모 댓글(1레벨) -->
		<if test="parentCommentNo == 0">
			NULL
		</if>
        )
    </insert>

    <!-- 단일 댓글 조회 -->
    <select id="selectComment" parameterType="int" resultType="BoardComment">
        SELECT *
        FROM BOARD_COMMENT
        WHERE COMMENT_ID = #{commentId}
    </select>

    <!-- 댓글/대댓글 삭제 -->
    <delete id="deleteComment" parameterType="int">
        DELETE FROM BOARD_COMMENT
        WHERE COMMENT_ID = #{commentId}
    </delete>

</mapper>