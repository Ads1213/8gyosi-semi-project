<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="edu.kh.eightgyosi.board.model.mapper.EditBoardMapper">

    <!-- 게시글 작성 -->
    <insert id="insertBoard" useGeneratedKeys="true" keyProperty="boardId">
        INSERT INTO board (board_title, board_content, board_view_count, board_is_deleted,
                           board_create, board_updated, board_type_no, member_no)
        VALUES (#{boardTitle}, #{boardContent}, 0, 'N', NOW(), NOW(), #{boardTypeNo}, #{memberNo})
    </insert>

    <!-- 게시글 수정 -->
    <update id="updateBoard">
        UPDATE board
        SET board_title = #{boardTitle},
            board_content = #{boardContent},
            board_updated = NOW()
        WHERE board_id = #{boardId}
    </update>

    <!-- 게시글 삭제 -->
    <delete id="deleteBoard">
        DELETE FROM board
        WHERE board_id = #{boardId} AND member_no = #{memberNo}
    </delete>

    <!-- 게시글 단일 조회 -->
    <select id="selectBoardDetail" resultType="edu.kh.eightgyosi.board.model.dto.Board">
        SELECT *
        FROM board
        WHERE board_id = #{boardId}
    </select>

    <!-- ===================== 이미지 ===================== -->

    <insert id="insertBoardImage">
        INSERT INTO board_image (img_path, img_original_name, img_rename, img_order, board_id, img_size)
        VALUES (#{imgPath}, #{imgOriginalName}, #{imgRename}, #{imgOrder}, #{boardId}, #{imgSize})
    </insert>

    <select id="selectBoardImageById" resultType="edu.kh.eightgyosi.board.model.dto.BoardImage">
        SELECT * FROM board_image WHERE img_no = #{imgNo}
    </select>

    <delete id="deleteBoardImage">
        DELETE FROM board_image WHERE img_no = #{imgNo}
    </delete>

    <select id="selectMaxImgOrder" resultType="int">
        SELECT IFNULL(MAX(img_order), 0) FROM board_image WHERE board_id = #{boardId}
    </select>

    <select id="selectBoardImages" resultType="edu.kh.eightgyosi.board.model.dto.BoardImage">
        SELECT * FROM board_image WHERE board_id = #{boardId} ORDER BY img_order ASC
    </select>

    <!-- ===================== 파일 ===================== -->

    <insert id="insertBoardFile">
        INSERT INTO board_file (uploadfile_origin, uploadfile_path, uploadfile_strg, uploadfile_size, uploadfile_date, board_id)
        VALUES (#{uploadfileOrigin}, #{uploadfilePath}, #{uploadfileStrg}, #{uploadfileSize}, #{uploadfileDate}, #{boardId})
    </insert>

    <select id="selectBoardFile" resultType="edu.kh.eightgyosi.board.model.dto.BoardFile">
        SELECT * FROM board_file WHERE uploadfile_no = #{uploadfileNo}
    </select>

    <delete id="deleteBoardFile">
        DELETE FROM board_file WHERE uploadfile_no = #{uploadfileNo}
    </delete>

    <select id="selectBoardFiles" resultType="edu.kh.eightgyosi.board.model.dto.BoardFile">
        SELECT * FROM board_file WHERE board_id = #{boardId}
    </select>

    <!-- ===================== 카테고리 ===================== -->
    <select id="selectCategoryList" resultType="edu.kh.eightgyosi.board.model.dto.Board">
        SELECT *
        FROM board_type
        ORDER BY boardTypeNo ASC
    </select>

</mapper>
