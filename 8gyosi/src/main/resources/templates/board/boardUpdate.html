<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 수정</title>

    <!-- CSS -->
    <link rel="stylesheet" href="/css/board/boardWrite-style.css">
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.css" rel="stylesheet">

    <!-- JS: jQuery 먼저, Summernote 다음 -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.js"></script>
</head>
<body>

<!-- 공통 헤더 -->
<th:block th:replace="~{common/header}"></th:block>

<main class="container">

    <!-- ================= 수정폼 ================= -->
    <form id="boardForm"
          th:action="@{/editBoard/{boardTypeNo}/{boardId}/update(boardTypeNo=${board.boardTypeNo}, boardId=${board.boardId})}"
          method="post" enctype="multipart/form-data" class="write-box">

        <!-- 제목 + 카테고리 -->
        <div class="title-wrapper">
            <select name="boardTypeNo" class="category-select" required>
                <option value="">게시판 선택</option>
                <option th:each="type : ${categoryList}"
                        th:value="${type.boardTypeNo}"
                        th:text="${type.boardTypeName}"
                        th:selected="${type.boardTypeNo == board.boardTypeNo}">
                </option>
            </select>
            <input type="text" name="boardTitle" th:value="${board.boardTitle}" placeholder="제목 입력" style="flex:1;" required>
        </div>

        <!-- 게시글 정보 -->
        <div class="board-info">
            <span th:text="${board.memberNickname}"></span>
            <span th:text="${board.boardCreateDate}"></span>
            <span>조회수 <span th:text="${board.boardViewCount}"></span></span>
        </div>

        <!-- 내용 -->
        <div class="content-wrapper">
            <textarea id="boardContent" name="boardContent" th:text="${board.boardContent}"></textarea>
        </div>

        <!-- 기존 이미지 -->
        <div class="boardImg file-wrapper">
            <h4>첨부 이미지</h4>
            <div th:each="img : ${board.boardImages}" class="boardImg-item">
                <img th:src="${img.imgPath}" class="preview">
                <button type="button" class="delete-image" th:data-img-id="${img.imgNo}">삭제</button>
            </div>
            <th:block th:if="${#lists.isEmpty(board.boardImages)}">
                <p>등록된 이미지가 없습니다.</p>
            </th:block>
            <input type="file" name="images" multiple>
        </div>

        <!-- 기존 파일 -->
        <div class="boardFile file-wrapper">
            <h4>첨부 파일</h4>
            <div th:each="file : ${board.boardFiles}" class="boardFile-item">
                <a th:href="@{'/editBoard/' + ${board.boardTypeNo} + '/file/' + ${file.uploadfileNo}}"
                   th:text="${file.uploadfileOrigin}" target="_blank"></a>
                <button type="button" class="delete-file" th:data-file-id="${file.uploadfileNo}">삭제</button>
            </div>
            <th:block th:if="${#lists.isEmpty(board.boardFiles)}">
                <p>등록된 파일이 없습니다.</p>
            </th:block>
            <input type="file" name="files" multiple>
        </div>

        <!-- 삭제할 ID -->
        <input type="hidden" name="deleteImageIds" id="deleteImageIds">
        <input type="hidden" name="deleteFileIds" id="deleteFileIds">

        <!-- 수정 제출 버튼 -->
        <div class="bottom-area">
            <button type="submit" class="submit-btn">수정 완료</button>
        </div>
    </form>

    <!-- ================= 게시글 삭제 버튼 ================= -->
    <form th:action="@{/editBoard/{boardTypeNo}/{boardId}/delete(boardTypeNo=${board.boardTypeNo}, boardId=${board.boardId})}"
          method="post" 
          onsubmit="return confirm('정말 게시글을 삭제하시겠습니까?');"
          style="margin-top:20px;">
        <button type="submit" class="delete-btn" style="background-color:#d9534f; color:white;">게시글 삭제</button>
    </form>

</main>

<!-- 공통 푸터 -->
<th:block th:replace="~{common/footer}"></th:block>

<!-- JS -->
<script th:src="@{/js/board/boardUpdate.js}"></script>

</body>
</html>

